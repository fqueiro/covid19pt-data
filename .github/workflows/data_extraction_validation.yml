name: Extract and validate DGS data (from downloaded PDF file)

on:
  schedule:
    - cron: 0 16 * * *

jobs:
  build:
    #if: startsWith(github.head_ref, 'dados')
    runs-on: ubuntu-latest
    #container: python:3

    steps:
      - uses: actions/checkout@v2
      #  with:
       #   ref: ${{ github.head_ref }}
      #- name: Configure pt_PT locale
      #  run: |
      #    apt-get update -y && apt-get install -y locales && echo "pt_PT.UTF-8 UTF-8" | tee -a /etc/locale.gen && locale-gen pt_PT.UTF-8
      #- name: Configure pt_PT (Europe/Lisbon) timezone
      #  run: |
      #    ln -fs /usr/share/zoneinfo/Europe/Lisbon /etc/localtime && dpkg-reconfigure --frontend noninteractive tzdata
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          python -m pip install -r .github/workflows/requirements.txt
      - name: Extract municipality data from arcgis
        run: | 
          python .github/workflows/extract_dados_concelhos.py
      - name: Plot graphs
        run: | 
          python .github/workflows/graphs.py
      - name: Commit all changes
        uses: stefanzweifel/git-auto-commit-action@v4.1.1
        with:
          commit_message: Update data for today 
          #branch: ${{ github.head_ref }}
